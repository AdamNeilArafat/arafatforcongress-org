<!DOCTYPE html>
<html lang="en">
<head>
  <base href="/">
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>üå≤ Evergreen Pact ‚Äî Two Paths, Clear Steps | Adam Neil Arafat for Congress</title>
  <meta name="description" content="The Evergreen Pact: triage, then reform. Every step helps working people without raising their taxes and restores checks on executive power." />
  <meta name="theme-color" content="#0d3b66" />
  <meta property="og:title" content="Evergreen Pact ‚Äî Two Paths, Clear Steps" />
  <meta property="og:description" content="Triage, then reform. Steps that lower costs for working people and restore checks and balances." />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="../assets/evergreen-tree.png" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Evergreen Pact ‚Äî Two Paths, Clear Steps" />
  <meta name="twitter:description" content="Triage, then reform. Steps that lower costs and restore checks and balances." />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>

  <style>
    :root{
      --primary:#0d3b66; --ink:#1b2634; --soft:#f6f9fc;
      --t0:#284b63; --t1:#0b6e4f; --t2:#0d3b66; --t3:#7a3e9d; --t4:#1f6feb; --t5:#c1121f;
      --flash:#fff3cd;
    }
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--soft);color:var(--ink)}
    a{color:var(--primary);text-decoration:none}
    a:hover{text-decoration:underline}
    .navbar .nav-link{position:relative;padding:.25rem .5rem;font-weight:600;color:#122133}
    .navbar .nav-link::after{content:"";position:absolute;left:0;bottom:-4px;height:2px;width:0;background:currentColor;border-radius:2px;transition:width .18s}
    .navbar .nav-link:hover::after,.navbar .nav-link.active::after{width:100%}

    .hero{position:relative;background:#0b3157;color:#fff}
    .hero::before{content:"";position:absolute;inset:0;background:linear-gradient(180deg,rgba(0,0,0,.25),rgba(0,0,0,.35))}
    .hero .container{position:relative;z-index:1}
    .hero h1{font-weight:900;letter-spacing:.3px;text-shadow:0 2px 10px rgba(0,0,0,.4)}

    /* Signature cards ‚Äî tighter & polished */
    .sig-card{background:#f8fafc;color:#0b2847;border:1px solid rgba(0,0,0,.06);border-radius:14px;padding:1rem;box-shadow:0 8px 18px rgba(0,0,0,.12)}
    .sig-card h2{font-size:1rem;margin:0 0 .25rem 0;letter-spacing:.2px}
    .sig-count{font-weight:800;line-height:1;margin:0}
    .sig-count .num{font-size:2.9rem}    /* big number for easy viewing */
    .sig-count .lbl{font-size:.8rem;opacity:.85}
    .sig-form .form-control{padding:.375rem .5rem}
    .sig-form .btn{padding:.42rem .75rem;font-weight:700}
    .sig-hint{font-size:.8rem;opacity:.95}

    /* Plan cards (kept minimal here) */
    .card-step{border:1px solid rgba(0,0,0,.06);border-radius:16px;background:#fff;box-shadow:0 6px 20px rgba(0,0,0,.06)}
    .card-step .card-body{padding:1rem 1.1rem}
    .tier-header{display:flex;align-items:center;gap:.75rem;margin:1.25rem 0 .75rem 0;color:#fff;border-radius:14px;padding:.75rem 1rem;box-shadow:0 8px 18px rgba(0,0,0,.12)}
    .badge-xl{display:inline-flex;align-items:center;justify-content:center;min-width:40px;height:40px;border-radius:10px;background:rgba(255,255,255,.18);font-weight:800}
    .tier-title{margin:0}
    .t0{background:linear-gradient(90deg,var(--t0),#1d3b4f)}
    .t1{background:linear-gradient(90deg,var(--t1),#0a5c41)}
    .t2{background:linear-gradient(90deg,var(--t2),#0a3157)}
    .t3{background:linear-gradient(90deg,var(--t3),#572d70)}
    .t4{background:linear-gradient(90deg,var(--t4),#174ea6)}
    .t5{background:linear-gradient(90deg,var(--t5),#8f0d16)}
    .mini{font-size:.92rem;color:#334155}

    footer{background:#0d3b66;color:#fff;padding:1.25rem 0}
  </style>
</head>
<body>

<!-- NAV -->
<nav class="navbar navbar-expand-lg bg-white border-bottom sticky-top" aria-label="Main">
  <div class="container">
    <a class="navbar-brand fw-bold" href="index.html">Adam Neil Arafat for Congress - WA-10</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMenu" aria-controls="navMenu" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navMenu">
      <ul class="navbar-nav ms-auto align-items-lg-center">
        <li class="nav-item"><a class="nav-link" href="digging-into-the-issues.html">Issues</a></li>
        <li class="nav-item"><a class="nav-link active" href="/Bills/Bills.html" aria-current="page"><i class="fa-solid fa-tree me-1 text-success" aria-hidden="true"></i>Evergreen Pact</a></li>
        <li class="nav-item"><a class="nav-link" href="contrast.html">Record &amp; Contrast</a></li>
        <li class="nav-item"><a class="nav-link" href="contact.html">Contact</a></li>
      </ul>
    </div>
  </div>
</nav>

<!-- HERO -->
<header class="py-5 hero">
  <div class="container text-center">
    <h1 class="display-6 mb-3">üå≤ The Evergreen Pact</h1>

    <!-- Signature block in header -->
    <div class="row justify-content-center g-3 mb-4">
      <!-- Candidates -->
      <div class="col-md-5">
        <div class="sig-card text-dark">
          <h2 class="fw-bold">‚úçÔ∏è Candidate Signatures</h2>
          <p class="sig-count mb-3">
            <span class="num text-success" id="candidateCount">‚Äî</span>
            <span class="lbl d-block">total signed</span>
          </p>
          <form id="candidateForm" class="needs-validation sig-form" novalidate>
            <input type="email" class="form-control form-control-sm mb-2" id="candidateEmail" placeholder="name@campaign.org" required>
            <div class="row g-2 mt-0">
              <div class="col-7">
                <input type="text" class="form-control form-control-sm" id="candidateCity" placeholder="City (optional)">
              </div>
              <div class="col-5">
                <input type="text" class="form-control form-control-sm" id="candidateState" placeholder="State (optional)">
              </div>
            </div>
            <button type="submit" class="btn btn-success w-100 mt-2">Sign as Candidate</button>
            <div id="candidateMsg" class="sig-hint mt-2" aria-live="polite"></div>
          </form>
        </div>
      </div>

      <!-- Voters -->
      <div class="col-md-5">
        <div class="sig-card text-dark">
          <h2 class="fw-bold">üó≥Ô∏è Voter Signatures</h2>
          <p class="sig-count mb-3">
            <span class="num text-primary" id="voterCount">‚Äî</span>
            <span class="lbl d-block">total signed</span>
          </p>
          <form id="voterForm" class="needs-validation sig-form" novalidate>
            <input type="email" class="form-control form-control-sm mb-2" id="voterEmail" placeholder="name@email.com" required>
            <div class="row g-2 mt-0">
              <div class="col-7">
                <input type="text" class="form-control form-control-sm" id="voterCity" placeholder="City (optional)">
              </div>
              <div class="col-5">
                <input type="text" class="form-control form-control-sm" id="voterState" placeholder="State (optional)">
              </div>
            </div>
            <button type="submit" class="btn btn-primary w-100 mt-2">Sign as Voter</button>
            <div id="voterMsg" class="sig-hint mt-2" aria-live="polite"></div>
          </form>
        </div>
      </div>
    </div>

    <div class="d-flex justify-content-center gap-2 flex-wrap">
      <a class="btn btn-outline-light fw-bold" href="Overview.html" target="_blank" rel="noopener noreferrer" aria-label="Open Overview PDF (Overview.html)">
        <i class="fa-solid fa-file-pdf" aria-hidden="true"></i> Download PDF
      </a>
    </div>
  </div>
</header>

<!-- EXPLANATION -->
<section class="container my-4">
  <div class="row justify-content-center">
    <div class="col-lg-10">
      <h2 class="h4">What the Evergreen Pact is</h2>
      <p class="mb-2"><strong>The Evergreen Pact is triage, then reform.</strong> We stop the bleeding now, then install hard blocks, transparency, and oversight to restore checks and balances using every lawful tool. Every step lowers costs for working people without raising their taxes.</p>
    </div>
  </div>
</section>

<section class="container my-5">
  <div class="alert alert-info small">This demo file focuses on the header signature blocks and API wiring. Plug it into your full Bills page to replace the top section.</div>
</section>

<footer>
  <div class="container text-center small">
    <p class="mb-1">Paid for by Adam Neil Arafat for Congress</p>
    <p class="mb-0">&copy; 2025 Adam Neil Arafat. All Rights Reserved.</p>
  </div>
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
  // ===== Replace with your deployed Apps Script Web App URL (must end with /exec)
  const SIGN_API = 'https://script.google.com/macros/s/AKfycbwZBBjLjxgnY7lrIwjtzNVP-p5-fi-eHbpKJ012C9ttypySE-gVIRcK9xw9wh6S0m86/exec';
  // Backend computes SHA-256 email hashes in hex for duplicate detection

  // UA + safe GEO fallback
  const UA_STRING = navigator.userAgent || '';
  window.GEO = window.GEO || { city:'', state:'' };

  // Bootstrap validation
  (function () {
    const forms = document.querySelectorAll('.needs-validation');
    Array.from(forms).forEach(form => {
      form.addEventListener('submit', evt => {
        if (!form.checkValidity()) {
          evt.preventDefault(); evt.stopPropagation();
        }
        form.classList.add('was-validated');
      }, false);
    });
  })();

  // Get counts
  async function fetchCounts() {
    try {
      const res = await fetch(`${SIGN_API}?t=${Date.now()}`, { method: 'GET' });
      const data = await res.json();
      if (data?.ok && data.counts) {
        document.getElementById('candidateCount').textContent = data.counts.candidates;
        document.getElementById('voterCount').textContent = data.counts.voters;
      }
    } catch (e) {
      console.warn('Count fetch failed', e);
    }
  }

  // Submit signature (form-encoded ‚Üí avoids CORS preflight)
  async function sendSignature(type, email, city, state, msgEl, buttonEl) {
    try {
      buttonEl.disabled = true;

      const body = new URLSearchParams({
        type, email,
        city: city || '',
        state: state || '',
        ua: UA_STRING
      });

      const res = await fetch(SIGN_API, {
        method: 'POST',
        body // no custom headers ‚Üí browser uses application/x-www-form-urlencoded
      });

      if (!res.ok) throw new Error('HTTP ' + res.status);
      const data = await res.json().catch(() => { throw new Error('Non-JSON response'); });
      if (!data.ok) throw new Error(data.error || 'Backend error');

      const { counts, duplicate } = data;
      document.getElementById('candidateCount').textContent = counts.candidates;
      document.getElementById('voterCount').textContent = counts.voters;

      msgEl.className = 'sig-hint mt-2 ' + (duplicate ? 'text-warning' : 'text-success');
      msgEl.textContent = duplicate ? 'You already signed. Thank you!' : 'Thank you for signing!';
    } catch (err) {
      console.error('Sign error:', err);
      msgEl.className = 'sig-hint mt-2 text-danger';
      msgEl.textContent = 'Sorry‚Äîsomething went wrong. Check that the URL ends with /exec and access is set to Anyone.';
    } finally {
      buttonEl.disabled = false;
    }
  }

  // Init
  document.addEventListener('DOMContentLoaded', () => {
    fetchCounts();

    const cForm = document.getElementById('candidateForm');
    if (cForm) cForm.addEventListener('submit', e => {
      e.preventDefault();
      if (!cForm.checkValidity()) return;
      const email = document.getElementById('candidateEmail').value.trim();
      const city  = document.getElementById('candidateCity')?.value?.trim() || GEO.city;
      const state = document.getElementById('candidateState')?.value?.trim() || GEO.state;
      sendSignature('candidate', email, city, state,
        document.getElementById('candidateMsg'),
        cForm.querySelector('button[type="submit"]'))
        .then(() => cForm.reset());
    });

    const vForm = document.getElementById('voterForm');
    if (vForm) vForm.addEventListener('submit', e => {
      e.preventDefault();
      if (!vForm.checkValidity()) return;
      const email = document.getElementById('voterEmail').value.trim();
      const city  = document.getElementById('voterCity')?.value?.trim() || GEO.city;
      const state = document.getElementById('voterState')?.value?.trim() || GEO.state;
      sendSignature('voter', email, city, state,
        document.getElementById('voterMsg'),
        vForm.querySelector('button[type="submit"]'))
        .then(() => vForm.reset());
    });
  });
</script>
</body>
</html>
