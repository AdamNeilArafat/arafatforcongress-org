<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Evergreen Reckoning — Awards • Wall • Countdowns • Impacts • Press</title>
  <meta name="description" content="Evergreen Reckoning hub: awards for NO voters, wall-by-bill tracker, live countdowns, bill impacts, and press-kit tools."/>
  <meta name="theme-color" content="#0d3b66"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>
  <style>
    :root{ --primary:#0d3b66; --accent:#0b6e4f; --danger:#c1121f; --ink:#1b2634; --soft:#f6f9fc; }
    body{ font-family: system-ui,-apple-system,Segoe UI,Roboto,sans-serif; color:var(--ink); background:var(--soft); }
    header.hero{ background:#fff; border-bottom:1px solid #e6edf3; }
    .kicker{ letter-spacing:.06em; font-size:.84rem; color:var(--accent); text-transform:uppercase; }
    .pillbar .nav-link{ border-radius:999px; }
    .section{ background:#fff; border:1px solid #e6edf3; border-radius:1rem; padding:1.25rem; }
    .award-card{ border:2px solid var(--primary); border-radius:1rem; padding:1rem; height:100%; }
    .award-title{ color:var(--danger); font-weight:800; font-size:1.05rem; }
    .award-meaning{ font-style:italic; color:#3b4856; }
    .clock-card{ background:#fff; border:2px solid var(--primary); border-radius:1rem; padding:1rem; text-align:center; }
    .clock-days{ font-size:2.2rem; font-weight:800; color:var(--danger); }
    .anchor{ scroll-margin-top: 100px; }
    /* Wall */
    .face-card{ border:1px solid #e6edf3; border-radius:.75rem; padding:.75rem; background:#fff; height:100%; }
    .chip{ display:flex; gap:.75rem; align-items:center; }
    .chip img{ width:56px; height:68px; object-fit:cover; border-radius:.4rem; border:1px solid #dfe6ee; }
    .seat{ text-transform:uppercase; }
    .bill-heading{ border-bottom:1px solid #e6edf3; padding-bottom:.25rem; margin-bottom:.75rem; }
    @media print{ .no-print{ display:none !important; } .section{ border:none; padding:0; } body{ background:#fff; } }
  </style>
</head>
<body>
  <header class="hero">
    <nav class="container d-flex align-items-center justify-content-between py-3">
      <div class="d-flex align-items-center gap-2">
        <i class="fa-solid fa-tree text-success"></i>
        <strong class="me-2">Evergreen Reckoning</strong>
        <span class="badge text-bg-primary">Accountability Hub</span>
      </div>
      <div class="d-flex gap-2 no-print">
        <button class="btn btn-outline-secondary" onclick="window.print()"><i class="fa-solid fa-print me-1"></i> Print / PDF</button>
      </div>
    </nav>
  </header>

  <main class="container py-4">
    <!-- Tabs -->
    <ul class="nav nav-pills pillbar gap-2 mb-3 no-print">
      <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#awards">Awards</a></li>
      <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#wall">Wall of Shame</a></li>
      <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#countdowns">Countdowns</a></li>
      <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#presskit">Press Kit</a></li>
    </ul>

    <div class="tab-content">
      <!-- AWARDS -->
      <section id="awards" class="tab-pane fade show active section">
        <div class="d-flex justify-content-between align-items-end">
          <div>
            <p class="kicker mb-1">Evergreen Shame Awards</p>
            <h1 class="h4 mb-2">Awards for NO Voters</h1>
          </div>
          <div class="no-print">
            <a class="btn btn-outline-primary" href="#wall"><i class="fa-solid fa-table-list me-1"></i> View Wall</a>
          </div>
        </div>
        <div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-3 mt-1" id="awardsGrid"></div>
      </section>

      <!-- WALL -->
      <section id="wall" class="tab-pane fade section">
        <div class="d-flex justify-content-between align-items-end">
          <div>
            <p class="kicker mb-1">All Seats • NO Votes • Awards • Timers</p>
            <h2 class="h4 mb-2">Wall of Shame (535-seat ledger)</h2>
            <div class="text-muted small">Filter by chamber, party, state, or name.</div>
          </div>
        </div>
        <!-- Filters -->
        <div class="row g-2 mt-2 no-print">
          <div class="col-md-2">
            <select id="wfChamber" class="form-select form-select-sm">
              <option value="">All Chambers</option>
              <option value="house">House</option>
              <option value="senate">Senate</option>
            </select>
          </div>
          <div class="col-md-2">
            <select id="wfParty" class="form-select form-select-sm">
              <option value="">All Parties</option>
              <option value="D">Democrat</option>
              <option value="R">Republican</option>
              <option value="I">Independent</option>
            </select>
          </div>
          <div class="col-md-2"><input id="wfState" class="form-control form-control-sm" placeholder="State (e.g., WA)"/></div>
          <div class="col-md-3"><input id="wfSearch" class="form-control form-control-sm" placeholder="Search name"/></div>
          <div class="col-md-3">
            <select id="wfSort" class="form-select form-select-sm">
              <option value="last">Sort: Last Name</option>
              <option value="party">Sort: Party</option>
              <option value="state">Sort: State</option>
              <option value="chamber">Sort: Chamber</option>
            </select>
          </div>
        </div>
        <div id="wallMount" class="mt-3"></div>
      </section>

      <!-- COUNTDOWNS -->
      <section id="countdowns" class="tab-pane fade section">
        <div class="d-flex justify-content-between align-items-end">
          <div>
            <p class="kicker mb-1">Days Since Their NO Vote</p>
            <h2 class="h4 mb-2">Accountability Countdowns</h2>
          </div>
        </div>
        <ul class="nav nav-tabs mt-3" id="cdTabs" role="tablist"></ul>
        <div class="tab-content border border-top-0 rounded-bottom p-3 bg-white" id="cdTabContent"></div>
      </section>

      <!-- PRESS KIT -->
      <section id="presskit" class="tab-pane fade section">
        <p class="kicker mb-1">Tools & Templates</p>
        <h2 class="h4 mb-3">Press Kit & Assets</h2>
        <div class="row g-3" id="pressLinks"></div>
      </section>
    </div>
  </main>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

  <script>
    // -------- Bills with file links (from your Bills/ folder) --------
    const BILLS = [
      // Cost-of-living
      { id:'grocery',    bill:'Fair Food and Grocery Competition Bill (2027)', href:'../Bills/Fair Food and Grocery Competition Bill (2027).html', award:'The Empty Fridge Award', meaning:'They protected price-fixers, leaving families to choose between groceries or rent.' },
      { id:'childcare',  bill:'Affordable Child and Dependent Care Bill (2027)', href:'../Bills/Affordable Child and Dependent Care Bill (2027).html', award:'The Parent Punisher Award', meaning:'They voted to keep childcare unaffordable and push parents out of work.' },
      { id:'jobs',       bill:'Good Jobs & Skills Bill (2027)', href:'../Bills/Good Jobs & Skills Bill (2027).html', award:'The Paycheck Pickpocket Award', meaning:'They sided with corporate bosses to keep wages down and hours insecure.' },
      { id:'housing',    bill:'First-Time Homebuyer 3% Mortgage Bill (2027)', href:'../Bills/First-Time Homebuyer 3% Mortgage Bill (2027).html', award:'The Rent Raiser Award', meaning:'They blocked families from buying homes and left renters at the mercy of landlords.' },

      // Retirement & health
      { id:'socialsec',  bill:'Social Security Solvency Bill (2027)', href:'../Bills/Social Security Solvency Bill (2027).html', award:'The Senior Starver Award', meaning:'They gambled away retirement checks and put seniors on the chopping block.' },
      { id:'health',     bill:'Universal Healthcare Bill (2027)', href:'../Bills/Universal Healthcare Bill (2027).html', award:'The Hospital Evictor Award', meaning:'They voted to keep healthcare out of reach and push families into medical debt.' },

      // Tax & spending guardrails
      { id:'minibus',    bill:'Minibus Implementation Safeguards Bill (2027)', href:'../Bills/minibus-implementation-safeguards-bill (2027).html', award:'The Swamp Rat Award', meaning:'They voted to keep waste and insider deals flowing.' },
      { id:'csr',        bill:'Corporate Responsibility (CSR) Bill (2027)', href:'../Bills/Corporate Responsibility (CSR) Bill (2027).html', award:'The Greed Defender Award', meaning:'They protected exploiters who gouge workers and poison communities.' },
      { id:'taxfair',    bill:'Tax Fairness Bill (2027)', href:'../Bills/Tax Fairness Bill (2027).html', award:'The Wallet Raider Award', meaning:'They kept loopholes for the rich while draining working families dry.' },

      // Democracy & oversight
      { id:'comms',      bill:'Communications Integrity Bill (2027)', href:'../Bills/communications-integrity-bill-2027.html', award:'The Truth Killer Award', meaning:'They voted to shield government lies and bury the facts.' },
      { id:'justify',    bill:'Congressional Vote Justification Bill (2027)', href:'../Bills/Congressional Vote Justification Bill (2027).Html', award:'The Coward’s Mask Award', meaning:'They voted against explaining themselves, hiding their real loyalties.' },
      { id:'impeach',    bill:'Impeachment Continuity and Accountability Bill (2027)', href:'../Bills/Impeachment Continuity and Accountability Bill (2027).html', award:'The Sellout Shield Award', meaning:'They let corrupt officials keep perks and power during impeachment.' },
      { id:'emerg',      bill:'Emergency Powers Spend Pilot (DoD, 2027)', href:'../Bills/emergency-powers-spend-pilot-dod-bill-2027.html', award:'The Blank Check Award', meaning:'They handed over taxpayer money with no oversight.' },
      { id:'holman',     bill:'Surgical Riders — Holman Templates (2027)', href:'../Bills/surgical-riders-holman-templates-2027.html', award:'The Bureaucrat Bodyguard Award', meaning:'They protected the worst swamp desks from any accountability.' },
      { id:'gaodash',    bill:'Committee Report Directives Templates (2027)', href:'../Bills/committee-report-directives-templates-2027.html', award:'The Cover-Up Award', meaning:'They blocked watchdogs and let agencies run wild.' },

      // Energy / elections (mapped to files present)
      { id:'clean',      bill:'Energy Savings and Lower Bills Bill (2027)', href:'../Bills/Energy Savings and Lower Bills Bill (2027).html', award:'The Polluter’s Pet Award', meaning:'They kept dirty energy handouts and gutted protections.' },
      { id:'elections',  bill:'Clean Campaigns and Elections Bill (2027)', href:'../Bills/Clean Campaigns and Elections Bill (2027).html', award:'The Dark Money’s Best Friend Award', meaning:'They protected the money pipeline over voters.' }
      // If you create a Water/Wastewater page later, add: { id:'water', href:'../Bills/<file>.html', ... }
    ];

    // -------- Member loader (Bioguide + headshots) --------
    async function loadMembers() {
      const url = "https://raw.githubusercontent.com/unitedstates/congress-legislators/refs/heads/gh-pages/legislators-current.json";
      const data = await fetch(url, { cache: "no-store" }).then(r => r.json());
      const byBio = {};
      for (const m of data) {
        const bioguide = m.id?.bioguide;
        if (!bioguide) continue;
        const lastTerm = (m.terms || []).slice(-1)[0] || {};
        byBio[bioguide] = {
          bioguide,
          first: m.name?.first || "",
          last: m.name?.last || "",
          name: `${m.name?.first || ""} ${m.name?.last || ""}`.trim(),
          party: lastTerm.party || "",
          chamber: lastTerm.type === "sen" ? "senate" : "house",
          state: lastTerm.state || "",
          district: lastTerm.type === "rep" ? (lastTerm.district || "") : "",
          photo: `https://unitedstates.github.io/images/congress/225x275/${bioguide}.jpg`
        };
      }
      return byBio;
    }
    const seat = m => m.chamber==='house' ? `${m.state}-${m.district}` : m.state;
    const chip = m => `
      <div class="chip">
        <img src="${m.photo}" alt="${m.name}"/>
        <div>
          <div class="fw-semibold">${m.name}</div>
          <div class="small text-muted">${seat(m)}, ${m.party.toUpperCase()} • ${m.chamber}</div>
        </div>
      </div>`;

    // -------- Awards grid --------
    const awardsGrid = document.getElementById('awardsGrid');
    BILLS.forEach(b=>{
      const col = document.createElement('div');
      col.className = 'col';
      col.innerHTML = `
        <div class="award-card anchor" id="award-${b.id}">
          <div class="text-muted small mb-1"><a href="${b.href || '#'}" target="_blank" rel="noopener">${b.bill}</a></div>
          <div class="award-title">🏆 ${b.award}</div>
          <div class="award-meaning">${b.meaning}</div>
        </div>`;
      awardsGrid.appendChild(col);
    });

    // -------- Countdowns tabs --------
    const tabs = document.getElementById('cdTabs');
    const panes = document.getElementById('cdTabContent');
    BILLS.forEach((b,i)=>{
      tabs.insertAdjacentHTML('beforeend', `
        <li class="nav-item" role="presentation">
          <button class="nav-link ${i===0?'active':''}" data-bs-toggle="tab" data-bs-target="#tab-${b.id}" type="button" role="tab">${b.bill}</button>
        </li>`);
      panes.insertAdjacentHTML('beforeend', `
        <div class="tab-pane fade ${i===0?'show active':''}" id="tab-${b.id}" role="tabpanel">
          <div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-3" id="cards-${b.id}"></div>
        </div>`);
    });

    function updateClocks(){
      document.querySelectorAll('.clock-days[data-date]').forEach(el=>{
        const d = new Date(el.dataset.date);
        if (isNaN(d)) { el.textContent='—'; return; }
        const days = Math.floor((Date.now()-d.getTime())/86400000);
        el.textContent = `${days} days`;
      });
    }

    // -------- Wall render with filters --------
    function applyFilters(m, f){
      if (f.chamber && m.chamber!==f.chamber) return false;
      if (f.party && m.party!==f.party) return false;
      if (f.state && m.state!==f.state) return false;
      if (f.q && !m.name.toLowerCase().includes(f.q)) return false;
      return true;
    }

    async function init(){
      const MEMBERS = await loadMembers();
      const votes = await fetch('data/votes.json').then(r=>r.json());
      const noVotes = votes.filter(v=>v.vote==='NO');

      // group by bill
      const byBill = {};
      for (const v of noVotes) (byBill[v.bill_id] ||= []).push(v);

      // COUNTDOWNS
      BILLS.forEach(b=>{
        const container = document.getElementById(`cards-${b.id}`);
        if (!container) return;
        const rows = (byBill[b.id]||[]).sort((a,b2)=>{
          const A = MEMBERS[a.member_id]?.last || "";
          const B = MEMBERS[b2.member_id]?.last || "";
          return A.localeCompare(B);
        });
        container.innerHTML = rows.length ? rows.map(v=>{
          const m = MEMBERS[v.member_id];
          return `
            <div class="col">
              <div class="clock-card">
                ${m ? chip(m) : `<div class="fw-semibold">${v.member_id}</div>`}
                <div class="small mt-2 text-muted">${BILLS.find(x=>x.id===v.bill_id)?.bill || ''}</div>
                <div class="clock-days mt-1" data-date="${v.vote_date}">0</div>
                ${v.nickname ? `<div class="mt-1"><span class="badge text-bg-danger">${v.nickname}</span></div>` : ``}
              </div>
            </div>`;
        }).join('') : `<div class="text-muted">No recorded NO votes yet.</div>`;
      });
      updateClocks();

      // WALL
      const wallMount = document.getElementById('wallMount');
      function renderWall(){
        const f = {
          chamber: document.getElementById('wfChamber').value,
          party: document.getElementById('wfParty').value,
          state: document.getElementById('wfState').value.toUpperCase().trim(),
          q: document.getElementById('wfSearch').value.toLowerCase().trim(),
          sort: document.getElementById('wfSort').value
        };
        wallMount.innerHTML = BILLS.map(b=>{
          const rows = (byBill[b.id]||[])
            .filter(v => {
              const m = MEMBERS[v.member_id];
              return m ? applyFilters(m,f) : true;
            })
            .sort((a,b2)=>{
              const A = MEMBERS[a.member_id]; const B = MEMBERS[b2.member_id];
              if (f.sort==='party') return (A?.party||'').localeCompare(B?.party||'') || (A?.last||'').localeCompare(B?.last||'');
              if (f.sort==='state') return (A?.state||'').localeCompare(B?.state||'') || (A?.last||'').localeCompare(B?.last||'');
              if (f.sort==='chamber') return (A?.chamber||'').localeCompare(B?.chamber||'') || (A?.last||'').localeCompare(B?.last||'');
              return (A?.last||'').localeCompare(B?.last||'');
            })
            .map(v=>{
              const m = MEMBERS[v.member_id];
              return `
                <div class="col">
                  <div class="face-card">
                    ${m ? chip(m) : `<div class="fw-semibold">${v.member_id}</div>`}
                    <div class="small text-muted mt-1">Voted NO: ${v.vote_date}</div>
                    ${v.nickname ? `<div class="mt-1"><span class="badge text-bg-danger">${v.nickname}</span></div>` : ``}
                  </div>
                </div>`;
            }).join('') || `<div class="text-muted">No recorded NO votes.</div>`;

          const link = b.href ? `<a href="${b.href}" target="_blank" rel="noopener">${b.bill}</a>` : b.bill;
          return `
            <div class="mb-4">
              <h3 class="h6 bill-heading">${link}</h3>
              <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-2">${rows}</div>
            </div>`;
        }).join('');
      }

      ['wfChamber','wfParty','wfState','wfSearch','wfSort'].forEach(id=>{
        const el = document.getElementById(id);
        el.addEventListener('input', renderWall);
        el.addEventListener('change', renderWall);
      });
      renderWall();
    }

    // PRESS LINKS (cards)
    const pressLinks = document.getElementById('pressLinks');
    pressLinks.innerHTML = `
      <div class="col-md-6 col-xl-4">
        <div class="p-3 border rounded">
          <h3 class="h6">Wall of Shame (Tracker)</h3>
          <p class="small text-muted mb-2">NO voters by bill with awards.</p>
          <a class="btn btn-outline-primary w-100" href="#wall"><i class="fa-solid fa-table-list me-1"></i> Jump to Wall</a>
        </div>
      </div>
      <div class="col-md-6 col-xl-4">
        <div class="p-3 border rounded">
          <h3 class="h6">Countdown Tracker</h3>
          <p class="small text-muted mb-2">Live clocks by bill/member.</p>
          <a class="btn btn-outline-primary w-100" href="#countdowns"><i class="fa-solid fa-clock-rotate-left me-1"></i> Jump to Countdowns</a>
        </div>
      </div>
    `;

    // Go
    init();
  </script>
</body>
</html>
