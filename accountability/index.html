
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Wall of Shame — Who Voted Against You | Adam Neil Arafat for Congress</title>
  <meta name="description" content="See which Members voted against working families. Filter by bill, state, or party. Share receipts.">
  <meta name="theme-color" content="#0d3b66" />

  <!-- Open Graph -->
  <meta property="og:title" content="Wall of Shame — Who Voted Against You">
  <meta property="og:description" content="Filter by bill, state, or party. Every face has a receipt.">
  <meta property="og:type" content="website">
  <meta property="og:image" content="assets/share-wall.png">

  <!-- CSS/JS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet"/>
  <style>
    :root{
      --ink:#16222f; --muted:#5b748f; --soft:#f6f9fc; --brand:#0d3b66; --bad:#c1121f; --ok:#0b6e4f;
      --chip:#eef6ff; --chipTxt:#0d3b66;
    }
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;background:var(--soft);color:var(--ink)}
    a{color:var(--brand);text-decoration:none}
    a:hover{text-decoration:underline}

    .navbar .nav-link{position:relative;padding:.25rem .5rem;font-weight:600;color:#122133}
    .navbar .nav-link::after{content:"";position:absolute;left:0;bottom:-4px;height:2px;width:0;background:currentColor;border-radius:2px;transition:width .18s}
    .navbar .nav-link:hover::after,.navbar .nav-link.active::after{width:100%}

    header.hero{background:linear-gradient(180deg,#0d3b66,#0b3157);color:#fff}
    .hero h1{font-weight:900;letter-spacing:.3px;text-shadow:0 2px 10px rgba(0,0,0,.35)}
    .tools{display:flex;flex-wrap:wrap;gap:.5rem 1rem;align-items:center}
    .tools .form-select,.tools .form-control{min-width:160px}
    .tools .search{min-width:240px;max-width:380px}

    .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    @media (min-width:600px){ .grid{grid-template-columns:repeat(3,1fr)} }
    @media (min-width:992px){ .grid{grid-template-columns:repeat(5,1fr)} }

    .card-face{background:#fff;border:1px solid rgba(0,0,0,.06);border-radius:14px;overflow:hidden;box-shadow:0 6px 18px rgba(0,0,0,.06);transition:transform .15s,box-shadow .15s;border-top:3px solid transparent}
    .card-face:hover{transform:translateY(-3px);box-shadow:0 16px 36px rgba(0,0,0,.12)}
    .card-face .pic{aspect-ratio:225/275;background:#e6edf3;display:block;position:relative}
    .card-face img{width:100%;height:100%;object-fit:cover;display:block}
    .badge-award{position:absolute;left:8px;bottom:8px;background:rgba(193,18,31,.9);color:#fff;font-weight:800;border-radius:999px;padding:.18rem .5rem;font-size:.72rem}
    .body{padding:.6rem .7rem}
    .name{font-weight:800;font-size:1rem}
    .meta{font-size:.86rem;color:var(--muted)}
    .smallline{font-size:.8rem;color:#334155}
    .chips{display:flex;gap:.35rem;flex-wrap:wrap;margin-top:.35rem}
    .chip{font-size:.72rem;font-weight:800;padding:.2rem .5rem;border-radius:999px;background:var(--chip);color:var(--chipTxt)}
    .actions{display:flex;gap:.4rem;margin-top:.5rem}
    .btn-xs{--bs-btn-padding-y:.25rem;--bs-btn-padding-x:.45rem;--bs-btn-font-size:.78rem;border-radius:999px;font-weight:700}
    .skeleton{background:linear-gradient(90deg,#edf2f7, #f7fafc 50%, #edf2f7);background-size:200% 100%;animation:shimmer 1.2s infinite}
    .sk-card{height:320px;border-radius:14px}
    @keyframes shimmer{0%{background-position:200% 0}100%{background-position:-200% 0}}

    .empty{background:#fff;border:1px dashed #cbd5e1;border-radius:12px;padding:1rem;text-align:center;color:#334155}
    footer{background:#0d3b66;color:#fff;padding:1.25rem 0}
  </style>
</head>
<body>
  <!-- NAV -->
  <nav class="navbar navbar-expand-lg bg-white border-bottom sticky-top" aria-label="Main">
    <div class="container">
      <a class="navbar-brand fw-bold" href="index.html">Adam Neil Arafat for Congress - WA-10</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMenu" aria-controls="navMenu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navMenu">
        <ul class="navbar-nav ms-auto align-items-lg-center">
          <li class="nav-item"><a class="nav-link" href="digging-into-the-issues.html">Issues</a></li>
          <li class="nav-item"><a class="nav-link" href="Bills/Overview.html"><i class="fa-solid fa-tree me-1 text-success" aria-hidden="true"></i>Evergreen Pact</a></li>
          <li class="nav-item"><a class="nav-link" href="contrast.html">Record & Contrast</a></li>
          <li class="nav-item"><a class="nav-link" href="contact.html">Contact</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- HERO -->
  <header class="py-5 hero">
    <div class="container text-center">
      <h1 class="display-5 mb-2">Wall of Shame</h1>
      <p class="lead mb-0">Faces of the Members who voted against working families. Every card has a receipt.</p>
    </div>
  </header>

  <!-- TOOLS -->
  <section class="container my-3">
    <div class="tools">
      <div class="d-flex align-items-center gap-2">
        <label class="form-label mb-0 me-1" for="filterBill">Bill</label>
        <select id="filterBill" class="form-select form-select-sm" aria-label="Filter by bill"></select>
      </div>

      <div class="d-flex align-items-center gap-2">
        <label class="form-label mb-0 me-1" for="filterState">State</label>
        <select id="filterState" class="form-select form-select-sm" aria-label="Filter by state">
          <option value="">All</option>
        </select>
      </div>

      <div class="d-flex align-items-center gap-2">
        <label class="form-label mb-0 me-1" for="filterParty">Party</label>
        <select id="filterParty" class="form-select form-select-sm" aria-label="Filter by party">
          <option value="">All</option>
          <option value="D">Democrat</option>
          <option value="R">Republican</option>
          <option value="I">Independent</option>
        </select>
      </div>

      <div class="ms-auto d-flex align-items-center gap-2">
        <label for="search" class="visually-hidden">Search</label>
        <input id="search" class="form-control form-control-sm search" type="search" placeholder="Search name, award…" aria-label="Search"/>
        <button id="clear" class="btn btn-outline-secondary btn-sm">Clear</button>
      </div>
    </div>
  </section>

  <!-- GRID -->
  <section class="container mb-5" id="wall">
    <div id="grid" class="grid" aria-live="polite" aria-busy="true"></div>
    <div id="empty" class="empty mt-3 d-none">No matches. Try a different bill, state, or party.</div>
  </section>

  <!-- RECEIPT MODAL -->
  <div class="modal fade" id="receiptModal" tabindex="-1" aria-hidden="true" aria-labelledby="receiptTitle">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 id="receiptTitle" class="modal-title">Vote Receipt</h5>
          <button class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div id="receiptBody" class="small"></div>
        </div>
        <div class="modal-footer">
          <a id="receiptLink" class="btn btn-outline-primary btn-sm" target="_blank" rel="noopener">Open bill blueprint</a>
          <button id="shareBtn" class="btn btn-primary btn-sm"><i class="fa-solid fa-share-nodes me-1"></i>Share</button>
        </div>
      </div>
    </div>
  </div>

  <!-- CTA -->
  <section class="py-5" style="background:#f8f9fa;">
    <div class="container">
      <div class="row g-4 text-center">
        <div class="col-md-6">
          <div class="p-4 h-100 rounded" style="background:#0b6e4f;color:#fff">
            <h2 class="h5 fw-bold mb-2">Join the fight</h2>
            <p class="mb-3">This campaign runs on people, not corporate PAC money.</p>
            <a href="contact.html" class="btn btn-light fw-bold">I will volunteer</a>
          </div>
        </div>
        <div class="col-md-6">
          <div class="p-4 h-100 rounded" style="background:#c1121f;color:#fff">
            <h2 class="h5 fw-bold mb-2">Power the wall</h2>
            <p class="mb-3">Help us keep the receipts public and updated.</p>
            <a href="https://secure.actblue.com/donate/adam-arafat-1" class="btn btn-light fw-bold" target="_blank" rel="noopener">Chip in</a>
            <div class="small mt-2 text-light">Secure via ActBlue. People powered only.</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <footer>
    <div class="container text-center small">
      <p class="mb-1">Paid for by Adam Neil Arafat for Congress</p>
      <p class="mb-0">&copy; 2025 Adam Neil Arafat. All Rights Reserved.</p>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" defer></script>
  <script>
    // ---------- Config
    const CONFIG = { 
      imageBase: "https://unitedstates.github.io/images/congress/225x275/",
      billBase:  "Bills/",
      membersURL: "data/members.json",
      votesURL:   "data/votes.json"
    };

    // ---------- Utilities
    function debounce(fn, ms){ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a), ms); }; }
    function $(q,root=document){ return root.querySelector(q); }
    function $all(q,root=document){ return Array.from(root.querySelectorAll(q)); }

    // Accessible fallback badge image
    function fallbackSVG(name){
      const s = encodeURIComponent(`<svg xmlns='http://www.w3.org/2000/svg' width='225' height='275'><rect width='100%' height='100%' fill='#e6edf3'/><text x='50%' y='52%' text-anchor='middle' font-family='Arial' font-size='14' fill='#666'>${name?name.replace(/&/g,'&amp;'): 'NO IMG'}</text></svg>`);
      return `data:image/svg+xml;utf8,${s}`;
    }

    // ---------- Skeleton first paint
    function renderSkeleton(n=15){
      const grid = $('#grid'); grid.setAttribute('aria-busy','true'); grid.innerHTML='';
      for(let i=0;i<n;i++){
        const sk = document.createElement('div'); sk.className='sk-card skeleton'; grid.appendChild(sk);
      }
    }

    // ---------- Load data
    async function loadMembers(){
      try{
        const r = await fetch(CONFIG.membersURL, {cache:'no-store'});
        if(!r.ok) throw 0;
        const raw = await r.json();
        const map = {};
        for(const m of raw){
          if(!m.bioguide) continue;
          const name = m.name || `${m.first||''} ${m.last||''}`.trim();
          map[m.bioguide] = {
            bioguide:m.bioguide, name,
            party:m.party||'', chamber:m.chamber||'',
            state:m.state||'', district:m.district||'',
            photo: m.photo || (CONFIG.imageBase + m.bioguide + '.jpg')
          };
        }
        return map;
      }catch{
        // Hard fallback: blank map
        console.warn('members.json missing; wall will show empty state until provided.');
        return {};
      }
    }

    async function loadVotes(){
      try{
        const r = await fetch(CONFIG.votesURL, {cache:'no-store'});
        if(!r.ok) throw 0;
        return await r.json();
      }catch{
        console.warn('votes.json missing; rendering empty state.');
        return {};
      }
    }

    // ---------- Build filter options
    function buildFilterOptions(votes){
      const billSelect = $('#filterBill');
      const states = new Set(); states.add('');
      const stateSelect = $('#filterState');

      // Bills
      const bills = Object.keys(votes);
      billSelect.innerHTML = '';
      if(!bills.length){
        billSelect.innerHTML = '<option value="">No bills configured</option>';
      }else{
        billSelect.innerHTML = '<option value="">All bills</option>' + bills.map(slug=>{
          const t = votes[slug]?.title || slug;
          return `<option value="${slug}">${t}</option>`;
        }).join('');
      }

      // States (filled after we know members; we’ll also fill at render time)
      stateSelect.innerHTML = '<option value="">All</option>';
    }

    // ---------- Merge & render
    function card(member, ctx){
      const award = ctx.award || '';
      const meaning = ctx.meaning || '';
      const billSlug = ctx.slug;
      const billTitle = ctx.title || '';
      const photo = member.photo;
      const id = member.bioguide;
      const name = member.name;
      const district = member.chamber==='house' ? `${member.state}-${member.district}` : `${member.state}`;
      const party = member.party || '';
      const vote = ctx.vote || 'NO';

      return `
      <article class="card-face" data-bio="${id}" data-bill="${billSlug}" data-state="${member.state}" data-party="${party}">
        <a href="javascript:void(0)" class="pic" data-open="${id}" aria-label="Open receipt for ${name}">
          <img src="${photo}" alt="${name}" loading="lazy"
               onerror="this.onerror=null;this.src='${fallbackSVG(name)}'">
          ${award ? `<span class="badge-award" title="${award}">${award}</span>` : ''}
        </a>
        <div class="body">
          <div class="name">${name}</div>
          <div class="meta">${district} • ${party.toUpperCase()} ${member.chamber==='house'?'• House':'• Senate'}</div>
          ${meaning ? `<div class="smallline mt-1">${meaning}</div>` : ''}
          <div class="chips">
            <span class="chip">${vote} vote</span>
            ${billTitle ? `<span class="chip" title="${billTitle}">Bill</span>`:''}
          </div>
          <div class="actions">
            <button class="btn btn-outline-dark btn-xs" data-open="${id}" data-bill="${billSlug}">View receipt</button>
            <button class="btn btn-outline-secondary btn-xs" data-share="${id}" data-bill="${billSlug}"><i class="fa-solid fa-share-nodes"></i></button>
          </div>
        </div>
      </article>`;
    }

    function filterAndRender(members, votes){
      const billSel = $('#filterBill').value.trim();
      const stateSel = $('#filterState').value.trim();
      const partySel = $('#filterParty').value.trim();
      const term = $('#search').value.trim().toLowerCase();

      const grid = $('#grid'); const empty = $('#empty');
      grid.innerHTML='';

      // Build candidate set from votes
      let entries = [];
      const billKeys = billSel ? [billSel] : Object.keys(votes);
      for(const slug of billKeys){
        const v = votes[slug]; if(!v) continue;
        const offenders = v.offenders||[];
        for(const o of offenders){
          const m = members[o.bioguide];
          if(!m) continue;
          entries.push({
            m, slug, title:v.title||slug, award:v.award||'', meaning:v.meaning||'', vote:o.vote||'NO'
          });
        }
      }

      // Unique by bioguide per bill combination
      const seen = new Set();
      entries = entries.filter(e=>{
        const key = e.m.bioguide + '|' + e.slug;
        if(seen.has(key)) return false; seen.add(key); return true;
      });

      // Fill states dropdown if empty
      if($('#filterState').options.length <= 1){
        const st = new Set(['']);
        entries.forEach(e=>st.add(e.m.state));
        $('#filterState').innerHTML = Array.from(st).map(s=>`<option value="${s}">${s? s : 'All'}</option>`).join('');
      }

      // Apply filters
      const out = entries.filter(e=>{
        if(stateSel && e.m.state !== stateSel) return false;
        if(partySel && e.m.party !== partySel) return false;
        if(term){
          const hay = (e.m.name + ' ' + e.award + ' ' + e.meaning + ' ' + e.title + ' ' + e.m.state + ' ' + e.m.district).toLowerCase();
          if(!hay.includes(term)) return false;
        }
        return true;
      });

      if(!out.length){
        empty.classList.remove('d-none'); grid.setAttribute('aria-busy','false'); return;
      } else empty.classList.add('d-none');

      // Render
      grid.innerHTML = out.map(e=>card(e.m, e)).join('');
      grid.setAttribute('aria-busy','false');
    }

    // ---------- Receipt modal + share
    function openReceipt(bioguide, billSlug, members, votes){
      const m = members[bioguide]; if(!m) return;
      const v = votes[billSlug]; if(!v) return;
      const title = v.title || billSlug;
      const link = CONFIG.billBase + (v.href || (title.toLowerCase().replace(/[^a-z0-9]+/g,'-') + '.html'));
      const district = m.chamber==='house' ? `${m.state}-${m.district}` : m.state;

      $('#receiptTitle').textContent = `${m.name} — ${v.award||'Receipt'}`;
      $('#receiptBody').innerHTML = `
        <div class="d-flex gap-2 align-items-start">
          <img src="${m.photo}" alt="${m.name}" width="64" height="78" style="object-fit:cover;border-radius:6px"
               onerror="this.onerror=null;this.src='${fallbackSVG(m.name)}'">
          <div>
            <div class="fw-bold">${m.name}</div>
            <div class="text-muted small">${district} • ${m.party.toUpperCase()} • ${m.chamber==='house'?'House':'Senate'}</div>
          </div>
        </div>
        <hr>
        <div class="small"><strong>Bill:</strong> ${title}</div>
        ${v.meaning ? `<div class="small mt-1"><strong>Why it matters:</strong> ${v.meaning}</div>`:''}
      `;
      $('#receiptLink').href = link;

      // share
      $('#shareBtn').onclick = async ()=>{
        const text = `${m.name} earned "${v.award}" for voting NO on: ${title}`;
        const url = location.origin + location.pathname + '#?bill=' + encodeURIComponent(billSlug) + '&bio=' + encodeURIComponent(m.bioguide);
        if(navigator.share){
          try{ await navigator.share({title:'Wall of Shame', text, url}); }catch(e){}
        } else {
          await navigator.clipboard.writeText(`${text} ${url}`);
          const btn = $('#shareBtn'); const old = btn.textContent;
          btn.textContent = 'Link copied'; setTimeout(()=>btn.textContent=old, 1200);
        }
      };

      bootstrap.Modal.getOrCreateInstance($('#receiptModal')).show();
    }

    // ---------- URL state
    function readHashParams(){
      if(!location.hash.startsWith('#?')) return {};
      const qs = location.hash.substring(2);
      const p = new URLSearchParams(qs);
      return Object.fromEntries(p.entries());
    }
    function writeHash(params){
      const p = new URLSearchParams(params);
      location.hash = '?' + p.toString();
    }

    // ---------- Main
    (async function init(){
      renderSkeleton(15);
      const [members, votes] = await Promise.all([loadMembers(), loadVotes()]);
      buildFilterOptions(votes);

      // Handle deep link
      const hp = readHashParams();
      if(hp.bill && votes[hp.bill]) $('#filterBill').value = hp.bill;

      // Initial render
      filterAndRender(members, votes);

      // Events
      const refilter = debounce(()=>{ 
        const bill = $('#filterBill').value.trim();
        writeHash({bill});
        filterAndRender(members, votes);
      }, 120);

      $('#filterBill').addEventListener('change', refilter);
      $('#filterState').addEventListener('change', refilter);
      $('#filterParty').addEventListener('change', refilter);
      $('#search').addEventListener('input', debounce(()=>filterAndRender(members, votes), 150));
      $('#clear').addEventListener('click', ()=>{ $('#search').value=''; filterAndRender(members, votes); });

      // Click handlers (event delegation)
      document.body.addEventListener('click', e=>{
        const openBtn = e.target.closest('[data-open]');
        if(openBtn){
          const bio = openBtn.getAttribute('data-open');
          const bill = openBtn.getAttribute('data-bill') || $('#filterBill').value.trim() || Object.keys(votes)[0];
          openReceipt(bio, bill, members, votes);
          return;
        }
        const shareBtn = e.target.closest('[data-share]');
        if(shareBtn){
          const bio = shareBtn.getAttribute('data-share');
          const bill = shareBtn.getAttribute('data-bill') || $('#filterBill').value.trim() || Object.keys(votes)[0];
          openReceipt(bio, bill, members, votes);
          return;
        }
      });
    })();
  </script>
</body>
</html>
