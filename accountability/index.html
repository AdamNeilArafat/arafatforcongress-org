<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Wall of Shame — Accountability</title>
  <link rel="preconnect" href="https://cdn.jsdelivr.net" />
  <style>
    :root {
      --ink: #122133; --muted: #5b6b7c; --soft: #f6f9fc; --brand: #0d3b66;
      --ring: rgba(13, 59, 102, 0.12); --ring-strong: rgba(13, 59, 102, 0.22);
    }
    html, body { background: var(--soft); color: var(--ink); font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; margin: 0; padding: 0; }
    a { color: var(--brand); text-decoration: none; } a:hover { text-decoration: underline; }
    .container { max-width: 1200px; margin: 0 auto; padding: 1rem; }
    h1 { font-weight: 900; margin-top: 1rem; }
    .controls { display: flex; flex-wrap: wrap; gap: 0.5rem; margin: 1rem 0; }
    .controls input[type="search"] { padding: 0.4rem 0.6rem; border: 1px solid var(--ring); border-radius: 6px; flex: 1; min-width: 220px; }
    .filter-group { display: flex; align-items: center; gap: 0.25rem; flex-wrap: wrap; }
    .filter-button { padding: 0.25rem 0.5rem; border-radius: 999px; border: 1px solid var(--ring); background: #fff; font-size: 0.8rem; cursor: pointer; }
    .filter-button.active { background: var(--brand); color: #fff; border-color: var(--ring-strong); }
    .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 1rem; }
    .card-person { position: relative; display: grid; grid-template-columns: 88px 1fr; gap: 0.6rem; background: #fff; border: 1px solid var(--ring); border-radius: 14px; overflow: hidden; cursor: pointer; transition: box-shadow 0.16s, transform 0.16s, border-color 0.16s; }
    .card-person:hover { box-shadow: 0 14px 40px rgba(13, 59, 102, 0.16); border-color: var(--ring-strong); transform: translateY(-2px); }
    .avatar { grid-row: 1 / span 2; width: 88px; height: auto; aspect-ratio: 4 / 5; object-fit: cover; display: block; margin: 0.6rem; border-radius: 8px; background: #e6edf3; }
    .card-person .body { padding: 0.75rem 0.9rem 0.9rem 0.2rem; }
    .name { font-weight: 800; }
    .meta { color: var(--muted); font-size: 0.85rem; margin-top: 0.1rem; }
    .statline{font-size:.85rem;color:var(--muted);margin-top:.15rem}.statline b{color:var(--ink)}
    .badge-rail { display: flex; flex-wrap: wrap; gap: 0.35rem; margin-top: 0.35rem; }
    .pill { display: inline-flex; align-items: center; gap: 0.35rem; font-size: 0.72rem; font-weight: 800; border-radius: 999px; padding: 0.25rem 0.5rem; background: #eef2f7; color: #0d3b66; border: 1px solid rgba(13, 59, 102, 0.12); white-space: nowrap; }
    .pill.red{background:#ffeded;border-color:#ffd0d0;color:#7a0a0a}
    .pill.gold{background:#fff7e0;border-color:#ffe5a3;color:#7a5200}
    .pill.blue{background:#eef2f7;border-color:rgba(13,59,102,.2);color:#0d3b66}
    .pill.green{background:#e9f7ef;border-color:#cfe9d8;color:#0b6e4f}
    /* Modal */
    #modal { position: fixed; inset: 0; background: rgba(0, 0, 0, 0.55); display: none; align-items: center; justify-content: center; padding: 1rem; }
    #modal.open { display: flex; }
    #modal .box { background: #fff; max-width: 800px; width: 100%; border-radius: 16px; padding: 1rem; max-height: 80vh; overflow: auto; position: relative; }
    #modal .close { position: absolute; top: 0.5rem; right: 0.5rem; font-size: 1.5rem; cursor: pointer; color: var(--muted); }
  </style>
  <script src="/assets/js/accountability.js"></script>
</head>
<body>
  <div class="container">
    <h1>Wall of Shame</h1>
    <p>See how money and votes line up. Filter by party, chamber, badge, or industry—and explore receipts and overrides.</p>
    <div class="controls">
      <input type="search" id="searchInput" placeholder="Search name, state, district" />
    </div>
    <div class="filter-group" id="partyFilters"></div>
    <div class="filter-group" id="chamberFilters"></div>
    <div class="filter-group" id="badgeFilters"></div>
    <div class="filter-group" id="industryFilters"></div>
    <div class="grid" id="grid"></div>
  </div>
  <div id="modal">
    <div class="box">
      <span class="close" onclick="Accountability.closeModal()">&times;</span>
      <div id="modal-body"></div>
    </div>
  </div>
  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      await Accountability.loadAll();
      const data = (Accountability._data||[]);
      const parties   = [...new Set(data.map(r => r.party))].filter(Boolean);
      const chambers  = [...new Set(data.map(r => r.chamber))].filter(Boolean);
      const industries= [...new Set(data.flatMap(r => Object.keys(r.shares || {})))].filter(i => i !== 'Unknown');
      const badges    = [...new Set(data.flatMap(r => [...(r.finance_badges||[]), ...(r.vote_badges||[]), ...(r.badges||[])]))];

      function createButtons(list, category, container) {
        list.forEach(val => {
          const btn = document.createElement('button');
          btn.className = 'filter-button';
          btn.textContent = val;
          btn.dataset.value = val;
          btn.addEventListener('click', () => {
            Accountability.toggleFilter(category, val);
            btn.classList.toggle('active');
            Accountability.renderWall(document.getElementById('grid'));
          });
          container.appendChild(btn);
        });
      }
      createButtons(parties,   'party',   document.getElementById('partyFilters'));
      createButtons(chambers,  'chamber', document.getElementById('chamberFilters'));
      createButtons(badges,    'badges',  document.getElementById('badgeFilters'));
      createButtons(industries,'industry',document.getElementById('industryFilters'));

      const searchInput = document.getElementById('searchInput');
      searchInput.addEventListener('input', () => {
        Accountability.setSearch(searchInput.value);
        Accountability.renderWall(document.getElementById('grid'));
      });

      Accountability.renderWall(document.getElementById('grid'));
    });
  </script>
</body>
</html>
