<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Financial Alignments & Interests</title>
  <style>
    :root { --ink:#122133; --muted:#5b6b7c; --soft:#f6f9fc; --brand:#0d3b66; --ring:rgba(13,59,102,.12) }
    html,body{background:var(--soft);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;margin:0;padding:0}
    .container{max-width:1200px;margin:0 auto;padding:1rem}
    h1{font-weight:900;margin-top:1rem}
    .controls{display:flex;flex-wrap:wrap;gap:.5rem;margin:1rem 0}
    .controls input[type="search"]{padding:.4rem .6rem;border:1px solid var(--ring);border-radius:6px;flex:1;min-width:220px}
    .filter-group{display:flex;gap:.25rem;flex-wrap:wrap}
    .filter-button{padding:.25rem .5rem;border-radius:999px;border:1px solid var(--ring);background:#fff;font-size:.8rem;cursor:pointer}
    .filter-button.active{background:var(--brand);color:#fff}
    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(250px,1fr));gap:1rem}
    .card-person{position:relative;display:grid;grid-template-columns:88px 1fr;gap:.6rem;background:#fff;border:1px solid var(--ring);border-radius:14px;overflow:hidden}
    .avatar{grid-row:1 / span 2;width:88px;aspect-ratio:4/5;object-fit:cover;display:block;margin:.6rem;border-radius:8px;background:#e6edf3}
    .body{padding:.75rem .9rem .9rem .2rem}
    .name{font-weight:800}.meta{color:#5b6b7c;font-size:.85rem;margin-top:.1rem}
    .statline{font-size:.85rem;color:#5b6b7c;margin-top:.15rem}.statline b{color:#122133}
    .badge-rail{display:flex;flex-wrap:wrap;gap:.35rem;margin-top:.35rem}
    .pill{display:inline-flex;align-items:center;gap:.35rem;font-size:.72rem;font-weight:800;border-radius:999px;padding:.25rem .5rem;background:#eef2f7;color:#0d3b66;border:1px solid rgba(13,59,102,.12)}
    .pill.red{background:#ffeded;border-color:#ffd0d0;color:#7a0a0a}
    .pill.gold{background:#fff7e0;border-color:#ffe5a3;color:#7a5200}
    .pill.blue{background:#eef2f7;border-color:rgba(13,59,102,.2);color:#0d3b66}
    .pill.green{background:#e9f7ef;border-color:#cfe9d8;color:#0b6e4f}
  </style>
  <script src="/assets/js/accountability.js"></script>
</head>
<body>
  <div class="container">
    <h1>Financial Alignments & Interests</h1>
    <p>Filter to update the aggregates, then click a member for receipts and votes.</p>
    <div class="controls"><input type="search" id="q" placeholder="Search name, state, district" /></div>
    <div class="filter-group" id="party"></div>
    <div class="filter-group" id="chamber"></div>
    <div class="filter-group" id="badge"></div>
    <div class="filter-group" id="industry"></div>
    <div class="grid" id="grid"></div>
  </div>

  <script>
  document.addEventListener('DOMContentLoaded', async () => {
    await Accountability.loadAll();
    const data=(Accountability._data||[]);
    const parties=[...new Set(data.map(r=>r.party))].filter(Boolean);
    const chambers=[...new Set(data.map(r=>r.chamber))].filter(Boolean);
    const industries=[...new Set(data.flatMap(r=>Object.keys(r.shares||{})))].filter(i=>i!=='Unknown');
    const badges=[...new Set(data.flatMap(r=>[...(r.finance_badges||[]),...(r.vote_badges||[]),...(r.badges||[])]))];

    function mk(list,key,el){ list.forEach(v=>{ const b=document.createElement('button'); b.className='filter-button'; b.textContent=v; b.onclick=()=>{Accountability.toggleFilter(key,v); b.classList.toggle('active'); Accountability.renderWall(document.getElementById('grid'));}; el.appendChild(b); }); }
    mk(parties,'party',document.getElementById('party'));
    mk(chambers,'chamber',document.getElementById('chamber'));
    mk(badges,'badges',document.getElementById('badge'));
    mk(industries,'industry',document.getElementById('industry'));

    const q=document.getElementById('q');
    q.oninput=()=>{ Accountability.setSearch(q.value); Accountability.renderWall(document.getElementById('grid')); };

    Accountability.renderWall(document.getElementById('grid'));
  });
  </script>
</body>
</html>
