<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Evergreen — Wall of Shame</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
<style>
.card-face{display:flex;gap:.75rem;align-items:center}
.card-face img{width:56px;height:68px;object-fit:cover;border-radius:.4rem;border:1px solid #dfe6ee}
</style>
</head>
<body class="bg-light">
<div class="container py-4">
  <h1 class="h4 mb-3">Wall of Shame</h1>
  <div id="wall"></div>
</div>

<script>
const BILLS = [
  { id:'grocery', title:'Fair Food & Grocery Competition' },
  { id:'childcare', title:'Affordable Child & Dependent Care' },
  { id:'jobs', title:'Good Jobs & Fair Pay' },
  { id:'housing', title:'3% First-Time Buyer' },
  { id:'socialsec', title:'Social Security Solvency' },
  { id:'health', title:'Universal Health Coverage' },
  { id:'minibus', title:'Implementation Safeguards' },
  { id:'csr', title:'CSR Tax' },
  { id:'taxfair', title:'Tax Fairness' },
  { id:'comms', title:'Communications Integrity' },
  { id:'justify', title:'Vote Justification' },
  { id:'impeach', title:'Impeachment Continuity' },
  { id:'emerg', title:'Emergency Spend Pilot' },
  { id:'holman', title:'Holman Amendments' },
  { id:'gaodash', title:'GAO Dashboard' },
  { id:'clean', title:'Clean Energy/Public Lands' },
  { id:'water', title:'Water/Wastewater Riders' }
];

async function loadMembers() {
  const url = "https://raw.githubusercontent.com/unitedstates/congress-legislators/refs/heads/gh-pages/legislators-current.json";
  const data = await fetch(url, { cache: "no-store" }).then(r => r.json());
  const byBio = {};
  for (const m of data) {
    const bioguide = m.id?.bioguide;
    if (!bioguide) continue;
    const lastTerm = (m.terms || []).slice(-1)[0] || {};
    byBio[bioguide] = {
      bioguide,
      name: `${m.name?.first || ""} ${m.name?.last || ""}`.trim(),
      last: m.name?.last || "",
      party: lastTerm.party || "",
      chamber: lastTerm.type === "sen" ? "senate" : "house",
      state: lastTerm.state || "",
      district: lastTerm.type === "rep" ? (lastTerm.district || "") : "",
      photo: `https://unitedstates.github.io/images/congress/225x275/${bioguide}.jpg`
    };
  }
  return byBio;
}

function chip(m){
  const seat = m.chamber==='house' ? `${m.state}-${m.district}` : m.state;
  return `<div class="card-face"><img src="${m.photo}" alt="${m.name}"/><div><div class="fw-semibold">${m.name}</div><div class="small text-muted">${seat}, ${m.party.toUpperCase()} • ${m.chamber}</div></div></div>`;
}

(async function(){
  const wall = document.getElementById('wall');
  const MEMBERS = await loadMembers();
  const votes = await fetch('accountability/data/votes.json').then(r=>r.json());
  const noVotes = votes.filter(v=>v.vote==='NO');
  const byBill = {};
  for (const v of noVotes) (byBill[v.bill_id] ||= []).push(v);

  wall.innerHTML = BILLS.map(b=>{
    const rows = (byBill[b.id]||[]).sort((a,b)=>{
      const A = MEMBERS[a.member_id]?.last || "";
      const B = MEMBERS[b.member_id]?.last || "";
      return A.localeCompare(B);
    }).map(v=>{
      const m = MEMBERS[v.member_id];
      return `
        <div class="col">
          <div class="border rounded p-2 h-100">
            ${m?chip(m):v.member_id}
            ${v.nickname ? `<div class="mt-2"><span class="badge text-bg-danger">${v.nickname}</span></div>` : ``}
            <div class="small text-muted mt-1">Voted NO: ${v.vote_date}</div>
          </div>
        </div>`;
    }).join('') || `<div class="text-muted">No recorded NO votes.</div>`;
    return `
      <div class="mb-4">
        <h2 class="h6">${b.title}</h2>
        <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-2">${rows}</div>
      </div>`;
  }).join('');
})();
</script>
</body>
</html>
